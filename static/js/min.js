var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};var ElevationChart,ElevationData,ElevationMarker,HikeMap,GPXTracks,GPXData;
function initHike(){HikeMap=L.map("hikeMap");L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(HikeMap);delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:RetinaMarkerIconURL,iconUrl:MarkerIconURL,shadowUrl:MarkerIconShadowURL});ElevationMarker=L.marker([0,0]).addTo(HikeMap);addGPXTracks()}
function asyncProcessGPXData(){addHikeStats();parseGPXElevationData();initScatterPlot()}function addGPXTracks(){GPXTracks=(new L.GPX(GPXFileURL,{async:!0,polyline_options:{color:"#EA2027",opacity:.75,weight:2,lineCap:"round"},marker_options:{startIconUrl:"/img/pin-icon-start.png",endIconUrl:"/img/pin-icon-end.png",shadowUrl:null}})).on("loaded",function(a){HikeMap.fitBounds(a.target.getBounds());GPXData=a.target;asyncProcessGPXData()}).addTo(HikeMap)}
function addHikeStats(){var a=(GPXData.get_distance()/1E3).toFixed(2);document.querySelector(".distance .dynamic").textContent=a+"km";a=GPXData.get_total_time();document.querySelector(".duration .dynamic").textContent=msToHMS(a);a=GPXData.get_total_speed().toFixed(2);document.querySelector(".speed .dynamic").textContent=a+"km/hr";a=parseFloat(GPXData.get_elevation_max().toFixed(0));var b=parseFloat(GPXData.get_elevation_min().toFixed(0));a-=b;b=parseFloat(GPXData.get_elevation_gain().toFixed(0));
var c=parseFloat(GPXData.get_elevation_loss().toFixed(0));document.querySelector(".elev .dynamic").textContent=a.toLocaleString()+"m";document.querySelector(".climb .dynamic").textContent=b.toLocaleString()+"m ("+c.toLocaleString()+"m)"}
function parseGPXElevationData(){var a=GPXData.get_elevation_data(),b=[],c=GPXData._layers[Object.keys(GPXData._layers)[0]];c=$jscomp.makeIterator(Object.entries(c._layers));for(var d=c.next();!d.done;d=c.next())d=$jscomp.makeIterator(d.value),d.next(),d=d.next().value,d.hasOwnProperty("_latlngs")&&(b=b.concat(d._latlngs));ElevationData=[];for(c=0;c<a.length;c++)0==c%5&&ElevationData.push({x:a[c][0].toFixed(2),y:a[c][1].toFixed(2),lat:b[c].lat,lng:b[c].lng})}
function initScatterPlot(){var a=document.getElementById("elevationProfile");a.height=500;ElevationChart=new Chart(a,{type:"scatter",data:{datasets:[{label:null,data:ElevationData,showLine:!0,backgroundColor:"rgba(0, 148, 50, 0.5)",borderColor:"rgba(0, 148, 50, 0.75)",pointRadius:0}]},options:{customLine:{color:"#009432"},legend:{display:!1},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(b,a){ElevationMarker.setLatLng([a.datasets[b.datasetIndex].data[b.index].lat,a.datasets[b.datasetIndex].data[b.index].lng]);
return["Distance: "+b.xLabel+"km","Elevation: "+b.yLabel.toLocaleString()+"m"]}},custom:function(a){0<a.opacity?ElevationMarker.setOpacity(1):ElevationMarker.setOpacity(0)}},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Elevation (m)"},ticks:{callback:function(a,c,d){return a.toLocaleString()+"m"}}}],xAxes:[{scaleLabel:{display:!0,labelString:"Distance (km)"},ticks:{min:0,max:parseFloat(ElevationData[ElevationData.length-1].x),callback:function(a,c,d){return a.toLocaleString()+"km"}}}]}},plugins:[{beforeEvent:function(a,
c){"mousemove"===c.type&&c.x>=c.chart.chartArea.left&&c.x<=c.chart.chartArea.right&&(a.options.customLine.x=c.x)},afterDraw:function(a,c){var b=a.chart.ctx,e=a.chartArea;isNaN(a.options.customLine.x)||(b.save(),b.strokeStyle=a.options.customLine.color,b.moveTo(a.options.customLine.x,e.bottom),b.lineTo(a.options.customLine.x,e.top),b.stroke(),b.restore())}}]})}
function msToHMS(a){a/=1E3;var b=parseInt(a/3600);a%=3600;var c=("00"+parseInt(a/60)).slice(-2);a=("00"+a%60).slice(-2);return b+":"+c+":"+a}document.addEventListener("DOMContentLoaded",initHike);