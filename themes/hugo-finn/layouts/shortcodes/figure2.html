{{ $page := .Page }}

{{ $lightboxURL := urls.JoinPath "fit-in/1024x/blog/" .Page.Slug (.Get "name") }}
{{ $fullSizeURL := urls.JoinPath "fit-in/3096x/blog/" .Page.Slug (.Get "name") }}
{{ $lightboxSignature := hmac "sha1" (getenv "HUGO_IMAGOR_SHA_SECRET") $lightboxURL "binary" | base64Encode | replaceRE `\+` "-" | replaceRE `\/` "_" }}
{{ $fullSizeSignature := hmac "sha1" (getenv "HUGO_IMAGOR_SHA_SECRET") $fullSizeURL "binary" | base64Encode | replaceRE `\+` "-" | replaceRE `\/` "_" }}
{{ $lightboxURLSigned := urls.JoinPath "https://imagor.lesueur.nz" $lightboxSignature $lightboxURL }}
{{ $fullSizeURLSigned := urls.JoinPath "https://imagor.lesueur.nz" $fullSizeSignature $fullSizeURL }}

<figure>
    <a class="glightbox" data-gallery='1' data-glightbox="description: {{ .Get "title" | markdownify }}<br/><br/>ðŸ“· {{ if .Get "author" }}{{ .Get "author" | markdownify }}{{ else }}Finn Le Sueur{{ end }}" href='{{ $fullSizeURLSigned }}' title='{{ .Get "title" }}'>
        <img
            src='{{ $lightboxURLSigned }}'
            alt='{{ .Get "title" }}'
            loading='lazy'
            {{ with .Get "height" }}height='{{ . }}'{{ end }}
            {{ with .Get "width" }}width='{{ . }}'{{ end }}
            />
    </a>
    <figcaption>{{ .Get "title" | markdownify }}<br/>ðŸ“·: {{ if .Get "author" }}{{ .Get "author" | markdownify }}{{ else }}Finn Le Sueur{{ end }}</figcaption>
</figure>
